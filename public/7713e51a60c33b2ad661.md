---
title: パケット解析
tags:
  - '#wireshark'
  - '#パケット解析'
private: true
updated_at: '2023-03-18T15:45:18+09:00'
id: 7713e51a60c33b2ad661
organization_url_name: null
slide: false
ignorePublish: false
---
# 概要

実践パケット解析をやっていく


# パケット解析の基礎

## パケット解析とは

ネットワーク上で起こっている事象の理解を助けるために、
ネットワークを流れるデーーたをキャプチャして解析する作業のこと。

パッケットキャプチャツールを使って行う。

## パケットキャプチャツールの例

CUIならtcpdump、GUIならOmniPeek, Wiresharkなどがある。

## パケットキャプチャツールの仕組み

パケットキャプチャツールの処理は3つのステップに分けることができる。

### 1.キャプチャ
キャプチャしたいネットワークに接続されているネットワークカード(NIC)をプロミスキャスモードに切り替えることによって、
パケットキャプチャツールがケーブルからバイナリの生データをキャプチャする。
`プロミスキャスモード`では自分が宛先になっているトラフィックだけではなく、
ネットワークセグメント上を流れる全てのトラフィックをネットワークカード経由でキャプチャできる。

### 2.変換
キャプチャされたバイナリデータを参照可能な形式に変換する。

### 3.解析
変換されたデータを解析する。

# ケーブルへの潜入

パケット解析はパケットキャプチャツールの設置位置によって有益なものになるかが決まる。
パケットキャプチャツールの設置をケーブルを監視する、ネットワークに潜入(tap)する、ケーブルに潜入する、キャプチャを仕込む(キャプる)といった表現が使われる。

## プロミスキャスモード













# Wireshark

## Wiresharkの基本

### 初めてのパケットキャプチャ

ネットワークには常に何らかの障害がある。
また、ネットワークが正常な時のベースラインと比較することで異常を見つけ出す。

#### 1.メニューの`Capture`の`Option`を選択

パッケットをキャプチャできるNICの一覧が表示される。
Trafic列にトラフィック量がグラフが表示される。
`▶︎`をクリックするとMACアドレスやIPアドレスなどが表示される。

![スクリーンショット 2020-04-18 6.56.15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/156096/47a3abe9-c6ff-2cb5-d81b-d5145f58cd6c.png "キャプチャできるNICの一覧")

#### 2.`Start`を押すとキャプチャされる

#### 3. 左上の赤い四角`Stop`ボタンを押すと停止する

### メインウィンドウ

パケットを選択すると3つのペインが表示される。
上から`Packet List`ペイン、`Packet Details`ペイン、`Packet Bytes`ペイン

![スクリーンショット 2020-04-18 7.14.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/156096/583df326-0b16-d1db-4253-ab15661504dd.png "3ペイン形式のメインウィンドウ")

#### Packet Listペイン
キャプチャファイルに存在するパケットの一覧が表示される。

#### Packet Detailペイン
特定のパケットの詳細が表示される。

#### Packet Bytes`ペイン
整形される前のパケットが表示される。

### 設定画面

メニューの`Wireshark`の`Preferences`を押すと設定画面が表示される。

<img width="730" alt="スクリーンショット 2020-04-18 7.28.04.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/156096/edcce7b8-d473-81dd-df12-5f5c5afde943.png">

### パケットの色分け

メニューの`View`の`Coloring Rules`を押すとパケットの色分けを変更できる。

## Wiresharkチートシート

### キャプチャファイルの操作

#### キャプチャファイルの保存、エクスポート

メニューの`File`→`Save As`
主に.pcapng形式で保存される。

一部のみ保存したいときは`File`→`Export Specified Packets`

CSVやXMLにエクスポートするときは`File`→`Export Packet Dissections`
もしくは`Save As`でファイル形式を指定する。

#### キャプチャファイルのマージ

マージとは2つのデータストリームを比較したり、別々にキャプチャした同じトラフィックのストリームを組み合わせたりすること。

`File`→`Merge`

### パケットの操作

#### パケットの検索

`Command`+`F`キー

#### パケットのマーキング

特定のパケットを右クリックして`Mark Packet`を選択。
もしくは`Command`+ `M`

### 時間設定

#### 設定方法

`View`+`Time Display Format`

#### 時間参照

あるパケットからの相対的な時刻を表示するには、特定のパケットを右クリックして、`Set/Unset Time Reference`
もしくは` Command`+`T`
基準のパケットは*REF*と表示される。

#### 時間調整

パケットのタイムスタンプを変更するには、`Edit`→`Time Shift`
もしくは`Command`+`SHIFT`+`T`








