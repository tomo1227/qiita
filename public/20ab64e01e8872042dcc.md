---
title: Github Actionã§è‰ãŒç”Ÿãˆã¦ã‚‹ã‹å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹
tags:
  - GitHub
  - GraphQL
  - LineNotify
  - GitHubActions
private: false
updated_at: '2024-07-01T00:10:57+09:00'
id: 20ab64e01e8872042dcc
organization_url_name: null
slide: false
ignorePublish: false
---
## æ¦‚è¦

å…ˆæ—¥ã€ä»¥ä¸‹ã®è¨˜äº‹ãŒãƒˆãƒ¬ãƒ³ãƒ‰ã«ä¸ŠãŒã£ã¦ã„ã‚‹ã®ã‚’è¦‹ã¾ã—ãŸã€‚

https://qiita.com/_ken_/items/f3a5386287311fcc99fe

è©¦ã—ã«ã‚„ã£ã¦ã¿ãŸã®ã§ã™ãŒã€contributesæ•°ã‚’å–å¾—ã§ãã¦ãŠã‚‰ãšã€ã†ã¾ãå‹•ä½œã—ã¦ã„ãªã‹ã£ãŸã®ã§æ”¹å–„ã—ã¦ã¿ã¾ã—ãŸã€‚

:::note warn
LINE Notifyã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ã§ã¯èª¬æ˜ã—ã¦ã„ãªã„ã®ã§ã€[å…ƒè¨˜äº‹](https://qiita.com/_ken_/items/f3a5386287311fcc99fe)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
:::

## Exploreã§è©¦ã—ã¦ã¿ã‚‹

https://docs.github.com/ja/graphql/overview/explorer

ã“ã“ã§å®Ÿé¨“çš„ã«è©¦ã—ã¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/156096/b63e49a4-abfb-4e48-31b1-61059bf9f30c.png)

contributionCalendarã®totalContributionsã§Contributionsæ•°ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚contributionsCollectionã®`from`ã¨`to`ã¯æ—¥ç¨‹ã—ã‹è¦‹ã¦ã„ãªã„ã®ã§ã€ä¸¡æ–¹ã¨ã‚‚ç¾åœ¨æ™‚åˆ»ã§å¤§ä¸ˆå¤«ã§ã™ã€‚ã¡ãªã¿ã«ã€`from`ã¨`to`ã‚’çœç•¥ã™ã‚‹ã¨å…¨Contributionsæ•°ã€æ—¥ã«ã¡ã‚’è·¨ãã¨ãã®æœŸé–“ã®åˆè¨ˆContributionsæ•°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```graphql
query ($DATE: DateTime, $USER: String!){
  user(login: $USER) {
    contributionsCollection(from: $DATE, to: $DATE) {
      contributionCalendar {
        totalContributions
      }
    }
  }
}
```

Variablesã®å€¤ã¯é©å½“ã«å¤‰ãˆã¦ãã ã•ã„ã€‚

```json:Variables
{
  "DATE": "2024-06-30T00:00:00Z",
  "USER": "tomo1227"
}
```

## Github Actionã§å®Ÿè£…

[å…ƒè¨˜äº‹](https://qiita.com/_ken_/items/f3a5386287311fcc99fe)ã§ã¯ã€curlã§è¡Œã£ã¦ã„ã¾ã—ãŸãŒã€ä»Šå›ã¯Github CLIã‚’ä½¿ç”¨ã—ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚Github CLIã§æ›¸ã„ãŸæ–¹ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€[å…ƒè¨˜äº‹](https://qiita.com/_ken_/items/f3a5386287311fcc99fe)ã§ã¯ã€æœ¬æ—¥ä¸­ã®ã‚³ãƒŸãƒƒãƒˆã®ä¸­ã«mainã¾ãŸã¯masterãƒ–ãƒ©ãƒ³ãƒã¸ã®ã‚³ãƒŸãƒƒãƒˆãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ãŒã€æœ¬è¨˜äº‹ã§ã¯ã€ãƒ–ãƒ©ãƒ³ãƒã¯é–¢ä¿‚ãªãã€è‰ãŒç”Ÿãˆã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠã‚Šã¾ã™ã€‚


```yaml
name: Check GitHub Contributions and Notify

on:
  schedule:
    - cron: "0 13 * * *" # æ¯æ—¥22æ™‚ã«å®Ÿè¡Œ

jobs:
  check-and-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Check for Contributions
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          DATE=$(date -u +"%Y-%m-%dT00:00:00Z")
          RESPONSE=$(gh api graphql -F DATE=$DATE -F USER=$GITHUB_REPOSITORY_OWNER -f query='
            query ($DATE: DateTime, $USER: String!){
              user(login: $USER) {
                contributionsCollection(from: $DATE, to: $DATE) {
                  contributionCalendar{
                    totalContributions
                  }
                }
              }
            }
            '
          )
          echo "Response: $RESPONSE"
          TOTAL_CONTRIBUTIONS=$(echo $RESPONSE | jq '.data.user.contributionsCollection.contributionCalendar.totalContributions')
          echo "Total contributions: $TOTAL_CONTRIBUTIONS"
          echo "TOTAL_CONTRIBUTIONS=$TOTAL_CONTRIBUTIONS" >> $GITHUB_ENV

      # LINEã«é€šçŸ¥(å…ƒè¨˜äº‹ã‹ã‚‰ç’°å¢ƒå¤‰æ•°åã¨æ–‡è¨€ã ã‘å¤‰ãˆã¾ã—ãŸ)
      - name: Send LINE Notification if No Contributions
        if: env.TOTAL_CONTRIBUTIONS == '0'
        env:
          LINE_TOKEN: ${{ secrets.LINE_TOKEN }}
          MESSAGE: "ğŸ‘®ä»Šæ—¥ã¯ã¾ã ã‚³ãƒŸãƒƒãƒˆã§ãã¦ã„ã¾ã›ã‚“!ä»Šã™ãã‚³ãƒŸãƒƒãƒˆã—ã‚ˆã†!!"
        run: |
          curl -X POST -H "Authorization: Bearer $LINE_TOKEN" -F "message=$MESSAGE" https://notify-api.line.me/api/notify
```

:::note info
ä»¥ä¸‹ã®ã‚ˆã†ã«`workflow_dispatch:`ã‚’è¿½åŠ ã™ã‚‹ã¨ã€Github Actionã‚’æ‰‹å‹•ã§è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```yaml
on:
  schedule:
    - cron: "0 13 * * *"
  workflow_dispatch:
```
:::

å®Ÿéš›ã«Github Actionã§å‹•ã‹ã—ãŸä¾‹ã§ã™ã€‚

https://github.com/tomo1227/line-notify/actions/runs/9732317616/job/26857818135
